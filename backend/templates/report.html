{% extends "layout.html" %}

{% block title %}{{ _('Fact-Check Report for:') }} {{ report.video_title }}{% endblock %}

{% block content %}
<div class="main-layout">
    <main class="main-content">
        <section class="input-section top-form">
            <input type="text" id="youtube-url" placeholder="{{ _('Paste a new YouTube link to check...') }}">
            <button id="factcheck-btn">{{ _('Run Another Fact Check') }}</button>
        </section>
        
        <section id="status-section" class="status-section" style="display: none;">
            <div class="loader"></div>
            <div id="status-log" class="status-log"></div>
        </section>
    
        <div class="report-wrapper">
            <div class="disclaimer-box">
                <p><strong>{{ _('Disclaimer:') }}</strong> {{ _('This report is AI-generated. It may contain errors and may not have access to real-time data. Please verify the information independently.') }}</p>
            </div>
            <header class="page-header">
                <p class="description">{{ _('Fact-check report for:') }}</p>
                <h1>{{ report.video_title }}</h1>
                <a href="{{ report.video_url }}" target="_blank" class="video-link">{{ _('Watch on YouTube') }}</a>
                <button id="share-btn" class="share-button-header">{{ _('Share Results') }}</button>
            </header>
            
            <img src="{{ report.thumbnail_url }}" alt="{{ _('Video Thumbnail') }}" class="video-thumbnail" onerror="this.style.display='none'">
    
            <section id="result-section" class="result-section">
                <div id="progress-container" class="progress-container"></div>
                <div id="confidence-container" class="confidence-container"></div>
                <div id="report-container" class="report-container"></div>
            </section>
        </div>
    </main>

    <aside class="sidebar-feed">
        <h4 class="feed-header-title">{{ _('Last checked:') }}</h4>
        <div id="feed-container">
            {% for analysis in recent_analyses %}
                {% if analysis.thumbnail_url and analysis.video_title != 'Title Not Found' %}
                <div class="feed-item" data-timestamp="{{ analysis.created_at }}">
                    <a href="/report/{{ analysis.id }}" class="feed-item-link">
                        <img src="{{ analysis.thumbnail_url }}" alt="" class="feed-thumbnail">
                        <div class="feed-info">
                            <h3 class="feed-title">{{ analysis.video_title }}</h3>
                            <p class="feed-stats">
                                {{ _('%(credibility)s%% Credibility / %(confidence)s%% Confidence', credibility=analysis.confirmed_credibility, confidence=analysis.average_confidence) }}
                            </p>
                        </div>
                    </a>
                </div>
                {% endif %}
            {% endfor %}
        </div>
        <div id="feed-loader" class="feed-loader" style="display: none;">{{ _('Loading more...') }}</div>
    </aside>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const reportData = {{ report | tojson }};
</script>
<script src="{{ url_for('static', filename='report.js') }}"></script>
{% endblock %}